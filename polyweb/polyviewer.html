<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<title>PolyViewer</title>
		<style type="text/css">
			@import "//ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojo/resources/dojo.css";
			@import "//ajax.googleapis.com/ajax/libs/dojo/1.10.4/dijit/themes/claro/claro.css";
			 @import "//ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojox/grid/resources/claroGrid.css";
			@import  "//ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojox/editor/plugins/resources/css/Save.css";
			@import "//ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojox/widget/Dialog/Dialog.css";
			@import "//ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojox/grid/enhanced/resources/claro/EnhancedGrid.css"; 
        	@import "/resources/demos/style.css";
		 	@import "css/polycss/button.css";
		 	@import "css/polycss/button2.css";
		 	@import "css/polydiag/polydiag.css";
			@import "css/polycss/login.css";
			@import "css/polycss/header-footer.css";
			@import "//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css";
			@import "//ajax.googleapis.com/ajax/libs/dojo/1.10.4//dijit/themes/claro/claro.css";
     		@import "//ajax.googleapis.com/ajax/libs/dojo/1.10.4//dijit/themes/claro/document.css";
     		 @import "//maxcdn.bootstrapcdn.com/bootswatch/3.3.4/flatly/bootstrap.min.css";
      		/*@import "//ajax.googleapis.com/ajax/libs/dojo/1.10.3//dijit/tests/css/dijitTests.css";*/
      		@import "js/cbtree/themes/claro/claro.css";
      		@import "//netdna.bootstrapcdn.com/font-awesome/3.0.2/css/font-awesome.css";
      		@import "css/polycss/myMblSwitch.css";
      		@import "https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css";
      		@import "js/igv/igv-1.0.9.css";
      		@import "https://cdn.jsdelivr.net/npm/pretty-checkbox@3.0/dist/pretty-checkbox.min.css";

	html, body {
    width: 100%;
    height: 100%;
    margin: 0;
}

.claro .demoLayout .edgePanel {
    background-color: #d0e9fc;
}

.tundra #navMenuCoverage.dijitToolbar {
				background-image:none;
		
		
				background-repeat: repeat-x;
              
                }
                
           .spinner {
  margin: 2px auto 0;
  width: 70px;
  text-align: center;
}

.spinner > div {
  width: 18px;
  height: 18px;
  background-color: #FFFFFF;
  border-radius: 100%;
  display: inline-block;
  -webkit-animation: bouncedelay 1.4s infinite ease-in-out;
  animation: bouncedelay 1.4s infinite ease-in-out;
  /* Prevent first frame from flickering when animation starts */
  -webkit-animation-fill-mode: both;
  animation-fill-mode: both;
}

.spinner .bounce1 {
  -webkit-animation-delay: -0.32s;
  animation-delay: -0.32s;
}

.spinner .bounce2 {
  -webkit-animation-delay: -0.16s;
  animation-delay: -0.16s;
}

@-webkit-keyframes bouncedelay {
  0%, 80%, 100% { -webkit-transform: scale(0.0) }
  40% { -webkit-transform: scale(1.0) }
}

@keyframes bouncedelay {
  0% 
   { 
    transform: scale(0.0);
    -webkit-transform: scale(0.0);
  }
  80%
  { 
    transform: scale(0.0);
    -webkit-transform: scale(0.0);
   
  }
  
   100% { 
    transform: scale(0.0);
    -webkit-transform: scale(0.0);
    
  } 40% { 
    transform: scale(1.0);
    -webkit-transform: scale(1.0);
  }
}     
.claro .demoLayout .edgePanel {
    background-color: #d0e9fc;
}

.coaro #navMenuCoverage.dijitToolbar {
				background-image:none;
		
		
				background-repeat: repeat-x;
              
                }
  
  
  #tabContainer .dijitTabChecked .tabLabel {
  color:red;
  font-weight:bold;
}
  
</style>
	 <script type="text/javascript">
 var dojoConfig = {
        parseOnLoad: true,
      };

    </script>

		    <script type="text/javascript" src="//code.jquery.com/jquery-2.0.2.min.js"></script>
		         	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
		    	<script src='https://cdn.plot.ly/plotly-latest.min.js'></script>     	
		    <!--     
		    <script type="text/javascript" src="js/igv/igv-1.0.9.js" djConfig="parseOnLoad: true"></script>
		    -->
		    
		    <script src="https://cdn.jsdelivr.net/npm/igv@2.11.2/dist/igv.min.js"></script>
		    
			<script src="//ajax.googleapis.com/ajax/libs/dojo/1.13.0/dojo/dojo.js" djConfig="parseOnLoad:true" type="text/javascript"></script>
				<script type="text/javascript" src="js/polyviewer/methods_polyviewer.js"></script>
		  	<script type="text/javascript" src="js/polyjs/include.polyviewer.js" djConfig="parseOnLoad:true"></script>
		   	<script type="text/javascript" src="js/polyjs/Utility/vp.js" djConfig="parseOnLoad:true"></script>
		   	<script type="text/javascript" src="js/polyjs/Utility/diag_global.js" djConfig="parseOnLoad:true"></script>
		   	<script type="text/javascript" src="js/polyjs/igv_methods.js" djConfig="parseOnLoad:true"></script>
		   	<script type="text/javascript" src="js/polyjs/alamut_methods.js" djConfig="parseOnLoad:true"></script>
		   	<script type="text/javascript" src="js/polyjs/chart_coverage.js"></script>
		   	<script type="text/javascript" src="js/polyjs/electro.js"></script>
		   	<script type="text/javascript" src="js/polyjs/polyweb.js"></script>
		   	<script type="text/javascript" src="js/polyjs/coverage/coverage_global.js"></script>
		   	<script type="text/javascript" src="js/polyjs/coverage/coverage_split.js"></script>
		   	<script type="text/javascript" src="http://www.dojotoolkit-fr.org/wp-content/uploads/dojo-adapter.js"></script>
            <script src="//cdnjs.cloudflare.com/ajax/libs/dygraph/1.1.1/dygraph-combined.js"></script>
		  	<script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
			<script type="text/javascript" src="js/polyjs/igv_view_methods.js" djConfig="parseOnLoad: true"></script>
			<script src="https://cdn.anychart.com/releases/v8/js/anychart-base.min.js"></script>
			<script src="https://cdn.anychart.com/releases/v8/js/anychart-tag-cloud.min.js"></script>	
		
<style>
label {
display: inline-block;
width: 5em;
}
</style>
		   	   
		  <script>
		
		  dojo.require("dijit.layout.LinkPane");
		  dojo.require("dijit.Toolbar");
		  dojo.require("dijit.layout.AccordionContainer");
		  dojo.require("dijit.form.NumberSpinner");
		  dojo.require("dijit.form.Button");
		  dojo.require("dijit.form.FilteringSelect");
			dojo.require("dojo.data.ItemFileWriteStore");
			dojo.require("dijit.TooltipDialog");
			dojo.require("dijit.Dialog");
			dojo.require("dojo.cookie");
			dojo.require("dijit.form.SimpleTextarea");
			dojo.require("dojox.editor.plugins.Save");
		   require(["dojo/parser", "dijit/form/CheckBox","dojo/data/ObjectStore","dojo/store/JsonRest","dijit/form/DropDownButton","dojox/form/CheckedMultiSelect"]);
		  dojo.require("dojox.grid.EnhancedGrid");
		  dojo.require("dojox.grid.enhanced.plugins.DnD");
		dojo.require("dojox.grid.enhanced.plugins.NestedSorting");
		dojo.require("dojox.grid.enhanced.plugins.IndirectSelection");
			dojo.require("dijit.layout.ContentPane");
		require(["dojo/dom","dojo/parser", "dijit/layout/TabContainer","dojo/domReady!"]);
		require(["dojox/layout/ScrollPane","dijit/ToolbarSeparator"]);
		dojo.require("dijit.ProgressBar");
		dojo.require("dijit.TitlePane");
		dojo.require("dijit.Menu");
		dojo.require("dojox.grid.enhanced.plugins.Menu");
		dojo.require("dijit.Menu");
		dojo.require("dijit.MenuItem");
		dojo.require("dijit.layout.StackContainer");
		dojo.require("dijit.layout.StackController");	
		dojo.require("dojox.layout.TableContainer");
		
		dojo.require("dojox.mobile");
        dojo.require("dojox.mobile.parser"); 
        dojo.require("dojox.mobile.Switch"); 
		dojo.require("dojo.io.iframe");
		require([ "dojo/_base/xhr","dojox/widget/DialogSimple", "dojox/widget/Dialog","dijit/MenuBar", "dijit/MenuBarItem", "dijit/PopupMenuBarItem","dijit/DropDownMenu", "dijit/MenuItem","dojox/mobile/Switch"]);

			var storeP;
			var storeG;
			var storeGroup;
		   	var project_name = param('project'); //"NGS2013_0201";
		   	document.title = "PolyViewer [" + project_name + "]";
		   var projectName =  project_name;
		   var transcripts =  param('transcripts').split("+");
		   var panel =  param('panel');
		   var tsamples;

 

        
        var is_project_update = 'no';
 
		  dojo.ready(function(){
	
  dojo.declare("mySavePlugin", [dojox.editor.plugins.Save],{
    save: function(content){
      this.inherited(arguments);
    }
  });

  dojo.subscribe(dijit._scopeName + ".Editor.getPlugin", null, function(o){
    if(o.plugin){ return; }
    var name = o.args.name.toLowerCase();
	
    if(name ===  "mysave"){
       o.plugin = new mySavePlugin({
         url: ("url" in o.args)?o.args.url:"",
         logResults: ("logResults" in o.args)?o.args.logResults:true
       });
     }
   });
   // Now we can parse the page since we defined our save plugin above.
//   dojo.parser.parse();
  });
  

dojo.addOnLoad(function() {	
	dijit.byId('waiting').show();
	checkPassword(project_name,okfunction);
});
	
var hideorshow =0;	
var button_colors= ["#90ED7D","#217DBB","#E08E0B","#65999F","#6CBF70"]	;
var nbshow=0;
function hideShowWait(){
    
     if (dijit.byId('waiting')) {
         if (hideorshow%2 ==0){
              dijit.byId('waiting').show();
               change_loading_button("pwaiting",button_colors[nbshow%6]);
               nbshow++;
              
         }
         else {
             dijit.byId('waiting').hide();
         }
         hideorshow ++;
     }
}		

function construct_url(url,tr) {
	
	if (typeof(panel) !== 'undefined') {
        url = url+"?project="+project_name+"&panel="+panel;
    }
    else {
    	url = url+"?project="+project_name;
    }    
    url += return_options();
     
    /* sample */
  
        p="all";
    url += "&patients="+p;
    
    	  t="all";
   
    
    //document.getElementById("label_patients").innerHTML = p;
    if (tr) {
    	url += "&transcripts="+tr;
	}
   
     var username = dojo.cookie("username");
    url += "&user_name="+username;
    return url;
    
 }

function onSearchAll_polyviewer (input,name){
    var string = "'*"+input+"*'";
    var grid = dijit.byId(name);
    grid.queryOptions = {ignoreCase: true};
   grid.filter({complexQuery: "name:"+string+"OR description:"+string+"OR users:"+string+"OR patient_name:"+string+"OR capture_name:"+string+"OR sites:"+string});
};
	
	var cookie_username;
     function checkPassword(project,okf){
    			 igv_js =  dojo.cookie("igv_js");
    			
    			 
               if (cookie_username == null){
            	   cookie_username = dojo.cookie("username");
               }
               if (cookie_username == null){
            	   dijit.byId('waiting').hide();
					dijit.byId('login').show();
					return;
               }
              var passwd = dojo.cookie("passwd");
              urlpasswd = url_listProject+"?type=login&pwd="+passwd+"&login="+cookie_username+"&action=list";
        
              if (project){
                urlpasswd = urlpasswd +"&project="+project+"&viewer=polyViewer";
              }
              var jsonStore = new dojo.data.ItemFileWriteStore({
                        url: urlpasswd
                });
                jsonStore.fetch({
                query: {
                    name: project
                },
                onComplete: okf,
                onError: error,     
            }); 
                
            
 }		
			
			
 var pbv =0;			

			
			
			
			function okfunction(items, request) {
				if (items.length == 0) {
				     //dijit.byId('waiting').hide();
					dijit.byId('login').show();
					return;
					};
					
				getGencodeTrackForProject(projectName);
				var url1 = construct_url(url_fast_patients);
			
				 storeP = new dojo.data.ItemFileWriteStore({
						url: url1
					});
				   storeP.fetch({onComplete: tabPatients});
				    storeP.fetch({onComplete:fillgridPatients});
				  
				  var url_header1 = url_header_polyviewer+"?project="+projectName+"&user="+cookie_username;
				  
                header.setHref(url_header1);
				reload_project();
				var elm = document.getElementById('checkbox');
 				 if (igv_js != document.getElementById("check_igv").checked) {
    				document.getElementById("check_igv").click();
  				}
    			
    			 
				//preload_coverage();
				
                var tabs = dijit.byId("tabPrincipal");
                    dojo.connect(tabs,"_transition", function(newPage, oldPage) {
                        if (newPage.id =="tab_project"){
                            just_reload_project();
                        }
                    });
                    
                    var grid = new dojox.grid.EnhancedGrid({
        				id: 'gridPatients',
        				structure: layoutPatients,
        				rowSelector: '10px',
        				plugins: {indirectSelection: {headerSelector:true,  field: 'active',name: 'Select', width:"40px", styles:"text-align: center;",selected:true}}}, document.createElement('div')
        				);
		
		  			dojo.byId("gridDivPatients").appendChild(grid.domNode);
		  
		   			grid.startup();	
		 		
		   			
						

				
				}
			
			
function fillgridPatients(){
		dijit.byId("gridPatients").setStore(storeP);
		dijit.byId("gridPatients").rowSelectCell.toggleAllSelection(true);

     }





function construct_content_pane_polycyto() {
/*	   <div disabled id="panel_polycyto" jsid="panel_polycyto" data-dojo-type="dijit/layout/ContentPane" title="PolyCyto" onshow="load_tab_polycyto();" style="display:none;font-size:9px;width:100%;overflow-x:auto;">
   		<div id="container_editor_polycyto" jsId="container_editor_polycyto" data-dojo-type="dijit/layout/TabContainer" refreshOnShow="true" data-dojo-props="splitter:false, region:'center'" style="width:100%;height:80%;"></div>
   </div> 
*/
require(["dojo/ready", "dijit/layout/ContentPane"], function(ready, ContentPane){
  ready(function(){
	
	 var tt =  new ContentPane({
      style:"font-size:9px;width:100%;overflow-x:auto;",
	title:"PolyCyto",
	id:"panel_polycyto",
	jsId:"panel_polycyto",
	href:"include_html/diag/editor_container_polycyto.html",
	preload:1,
    });

		tabPrincipal.addChild(tt);
		tt.connect(tt, 'onLoad',function(){load_tab_polycyto();});
		//load_tab_polycyto();
   });
 });
}
		
var is_genome_project = 0;
function just_reload_project(){
//	dijit.byId('waiting').show();
	var this_panel = panel;
	if (is_project_update == 'yes') {
		this_panel = 'sysid';
	}
	document.getElementById("summary").innerHTML =" Reload";
	var url_project = url_summary;
	var this_args = "project="+project_name+"&panel="+this_panel+"&user_name="+cookie_username;
	var xhr = new XMLHttpRequest();
	
	xhr.open('POST', url_project, true);
	xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
	//
	xhr.onreadystatechange = function() {
		document.getElementById("summary").innerHTML = this.response;
		dijit.byId('waiting').hide();
		}
dijit.byId('waiting').show();
	xhr.send(this_args);
	}
	
function reload_project(force){
	document.getElementById("summary").innerHTML = ' <span class="dijitInline dijitIconLoading"></span> Loading';
	dijit.byId('waiting').show();
	var this_panel = panel;
	if (is_project_update == 'yes') {
		this_panel = 'sysid';
	}
	var url_project = url_summary;
	var this_args = "project="+project_name+"&panel="+this_panel+"&user_name="+cookie_username;
	if(force){
		 this_args = this_args+"&force=1";
	}
	var xhr = new XMLHttpRequest();
	xhr.open('POST', url_project, true);
	xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
	dijit.byId('waiting').show();
	xhr.onreadystatechange = function() {
		//alert("coucou");
		dijit.byId('waiting').show();

	    if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
			document.getElementById("summary").innerHTML = this.response;
			
		    setTimeout(function() {
			
        		dijit.byId("editor_stack").set("disabled", "");
        		var tsamples = storeP._arrayOfAllItems;
	            for (i=0;i<tsamples.length;i++) {
					var item = tsamples[i];
					if (item.is_genome == 1) {
						is_genome_project = 1;
						break;
					}
	            }
        		if (is_genome_project == 1) {
				//	dijit.byId('panel_polycyto').set("disabled", "");
				construct_content_pane_polycyto();	
				
					//dijit.byId('popup_patients').show();
					//dijit.byId('popup_patients').hide();
				}
				else{
					construct_content_pane_dude();
				}
			
					dijit.byId('waiting').hide();
			}, 10);
	    }
	}
	xhr.send(this_args);
}

function show_hide_all_genes_from_panel() {
	alert('TOTO !');
	var check = document.getElementById("b_panel_view_genes").checked;
	alert('is checked: '+check);
	
	
	var divs = document.getElementsByClassName("panel_gene_not_found");
	console.log(divs);
	
	if (check == true) {
	
	}
	else {
		for(var i = 0; i < divs.length; i++) {
			divs[i].style.visibility = "hidden";
	    }
	}
	return;
}

function export_panel_genes (panel_name) {
	panel_name = panel_name.replace(/-/g, '_');
	panel_name = panel_name.replace(/ /g, '_');
	panel_name = panel_name.replace(/\./g, '_');
	var this_url = url_path + "/json_output_nodb/getPanelsFromDb.pl";
	this_url += "?project=" + project_name;
	this_url += "&export_xls=1";
	this_url += "&panel_name=" + panel_name;
	downloadFile(this_url);
}

dojo.require("dojo.io.iframe");
function downloadFile(url) {
    var downloadPdfIframeName = "downloadPdfIframe"; 
    var iframe = dojo.io.iframe.create(downloadPdfIframeName);
    dojo.io.iframe.setSrc(iframe, url, true);
} 


var AllTranscripts = new Array();

	
	function change_loading_button(name,color1,color2){
		var o = document.getElementById(name);
	    if (!o){ return; }
		o.style.backgroundColor = color1;            
		return;
	}
	
	function zoomCoverage(tr){
		var start_url = url_coverage;
		var url = construct_url(start_url,tr);
		dijit.byId("popup_coverage").show();
		dijit.byId("div_popup_coverage").setHref(url);
	}

	 function zoomCnv(tr,r,panel){        
         var start_url = url_cnv;            
         var url = construct_url(start_url,tr);
         dijit.byId("popup_coverage").show();
         dijit.byId("div_popup_coverage").setHref(url+"&large=1&panel="+panel);
        
         
      }
      
	 function goto_dejavu(vid,pname){
		var a = document.getElementById('url_dejavu_var');
		a.href = url_dejavu + "?input=" + vid;
		return open_dejavu_infos(vid,pname);
	}

	/* function byPatientDude(patient,level){
	      
	        var url = url_cnv_overview+"?project="+project_name+"&patient_dude="+patient+"&quality="+level;
	          dijit.byId("popup_dude").show();
	          dijit.byId("div_popup_dude").setHref(url);
	        
	      }	
*/
	 	function zoomHgmd(p,hid,vid){
	        
	        
	     
	            dijit.byId("popup_hgmd").show();
	            dijit.byId("div_popup_hgmd").setHref(url_hgmd_view+"?hid="+hid+"&vid="+vid+"&project="+p);
	        
	      }	
	 	
	 	function comment_cldb(id){
	            dijit.byId("popup_cldb").show();
	      } 	
	 	
	 	
	  
	  function zoomPrimer(cp,ml){
        
         var start_url = url_primer_coverage;
            
            var url = construct_url(start_url);
            url+="&capture="+cp+"&multiplex="+ml;
            dijit.byId("popup_coverage").show();
            dijit.byId("div_popup_coverage").setHref(url);
        
      }
		var tab_coverage = new Array();
		var first =0;
		var panel_coverage_stack_changed = 0;
		
		
// 		function preload_coverage(storeP,reload_flag) { 
		  
// 		     if (first >0) {
// 		         reload(5);
// 		         return;
// 		     }
// 		     first ++;
// 		       var tsamples = storeP._arrayOfAllItems;//dijit.byId("gridPatients").selection.getSelected();
		    	
// 		    //var url_cnv =    construct_url(url_cnv_overview)+"&test_cache=1";
//        // document.getElementById("waiting_text").textContent = "Loading Data... [0/25]";
// 	 require(["dojo/promise/all", "dojo/Deferred", "dojo/request", "dojo/_base/array", "dojo/dom-construct", "dojo/dom", "dojo/json", "dojo/domReady!"],
// 	function(all, Deferred, request, arrayUtil, domConstruct, dom, JSON) {
// 		//function preload_coverage(value){
//             var p="";
//             var samples = new Array();
//             var requests = new Array();
//              var url = url_flush+'?project='+project_name;
//              var progress_id =0;
//         	 var array_chr = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,'X','Y'];
//              var max =0;
              
//                    var i,j,temparray,chunk = 1;
//                    var labels = new Array;
//                    var z =0;
//                     for (i=0,j=array_chr.length; i<j; i+=chunk) {
//                         temparray = array_chr.slice(i,i+chunk);
//                         var temp = new Array();
//                         for (var x=0;x<temparray.length;x++){
//                             temp[x] = temparray[x].label;
//                         }
                        
//                         labels[z++] = array_chr[i];
//                     }
                     
//                           max =    labels.length +1;
                          
                          
//                       for(i=0;i<Math.round(labels.length/2);i++){
//                          requests[i] = request.get( url+"&patient_cached="+ labels[i], {
//                                                         handleAs: "json"
//                                                         }).then(function(response){
                                                            
//                                                             progress_id ++;
//                                                             myProgressBar.set( { value: progress_id } );
                                                          
//                                                             return 1;
//                                                             }) ;
//                            // do whatever
//                         }           
                    
                      
//                     myProgressBar.set( { value: 0,maximum:max } );
//                    dijit.byId('waiting_progress').show();   
                   

    
// 		var request2 = new Array();
// 		 all(requests).then(function(results){
		     
// 		      for(i=Math.round(labels.length/2);i<labels.length;i++){
//                          request2[i+labels.length] = request.get( url+"&chromosome="+ labels[i], {
//                                                         handleAs: "json"
//                                                         }).then(function(response){
//                                                             progress_id ++;
//                                                             myProgressBar.set( { value: progress_id } );
                                                          
//                                                             return 1;
//                                                             }) ;
//                            // do whatever
//                         }           
//                  request2[i+labels.length] = request.get(url_cnv, {
//                                                         handleAs: "html"
//                                                         }).then(function(response){
//                                                             progress_id ++;
//                                                             myProgressBar.set( { value: progress_id } );
                                                          
//                                                             return 1;
//                                                             }) ;
                                                             
//                 all(request2).then(function(results){
//                     if (reload_flag ==1) reload(5) ;
//                      dijit.byId('waiting_progress').hide();
//                 });
                    
                
//             });      

// 		});
		
// 		}
		


var myAlertDialog;
function warning(text){
	if (!myAlertDialog) {
			 myAlertDialog = new dijit.Dialog({
        			title: "Warning",
        			content: text,
        			style: "width: 200px;height:150px;font-size: 13px;"
    				});
    			}
  
    	myAlertDialog.show();
    				return;
	}		   


var polyquery_filters;
var panel_editor_stack_changed = 0;
var tab_patients = new Array();
var tab_editor_polyviewer = new Array();
var tab_editor_polycyto = new Array();
var tab_editor_polydude = new Array();
var tab_editor = new Array();

 


    
		

	function return_selected_patient(tab){
		for (var p in tab ){
			if (tab[p].get('selected')) { return p; }
		}
		return "";
	}	
	





function LoadIGVPatient_diag () {
		var patient = return_selected_patient(tab_patients);
    
    //var store =   new dojo.data.ItemFileWriteStore({url:url_igvbis});

    var url_igvbis =url_igv+"?project="+projectName;
    

        url_igvbis += "&patients=" + patient;
   
    
    var store = new dojo.data.ItemFileWriteStore({url:url_igvbis});

    store.fetch({
                onComplete: jumpToIgvXml
            
            });
}

function collapse_all(names,labels){
    var ps = names.split(";"); 
    var ls = labels.split(";"); 
	console.dir(ps);
    for (i=0;i<ps.length;i++){
        collapse(ps[i],ls[i]);
    }
    var d = document.getElementById(name);
    
}
function collapse(name,label){
	var d;
     d = document.getElementById(name);
    if (d == null){
    	
    console.log(name);
    	return;
    }
    	
    var l;
	 l = document.getElementById(label);
  	if (l == null){
    	
    console.log(name);
    return;
    }
    if (d.classList.contains("in")) {
        d.classList.remove("in");

     if (l){
           l.classList.remove("glyphicon-triangle-bottom");
           l.classList.add("glyphicon-triangle-right");
		//   d.style.display = "none";	
        }
    }
    else {
        d.classList.add("in");
	//	d.style.display = "block";		
         l.classList.remove("glyphicon-triangle-right");
         l.classList.add("glyphicon-triangle-bottom");
        
    }
}

 function select_enable(id){
     var select = document.getElementById(id);
  
 }
 
function select_all(check){
	 var tsamples = storeP._arrayOfAllItems;
   	 var x =0;
	   	for (i=0,j=tsamples.length; i<j; i++) {
		   var t = "check_"+tsamples[i].id[0];
		   dojo.byId(t).checked = check.checked;
	   }	
}

function selection(event,check){
	 
	if (event.shiftKey && check.checked == true){
		var tsamples = storeP._arrayOfAllItems;
		var start=-1;
		var end = -1;
		for (i=0,j=tsamples.length; i<j; i++) {
			  
			   var t = "check_"+tsamples[i].id[0];
			   if (dojo.byId(t).checked == true && start == -1) {
				   start =i;
			   }
			  if (dojo.byId(t) == check){
				  end =i;
			  }
			  
			   
		   }
		if (start < end){
			for (i=start+1; i<end; i++) {
				  var t = "check_"+tsamples[i].id[0];
				  dojo.byId(t).checked = true ;
			}
			
	
		}

		
	}
}

function view_time_exec_buttons(value) {
	var list_b_ids = value.split(';');
	for (i=0; i<list_b_ids.length; i++) {
		document.getElementById(list_b_ids[i]).style.display = "block";
	}
}






    
function resize(elem, percent) { elem.style.fontSize = percent+"em"; }




function send_print(p,mode){
           var p = span_name.innerHTML;
           var name = document.getElementById('input_name').value;   
	       printer(p,1,name);
	    }	
	function printer2(p,mode){
        span_name.innerHTML=p;
        dijit.byId('popup_patient_name').show();
        return;
        }    
	function get_alacarte(){
	var text = "";
	var tt = ["project_summary","graphic_coverage","all_coverage","cnv_coverage","table_variations","sanger_variations","validated_variations","todo_variations","all_variations"];
	for (var i=0;i<tt.length;i++){
		if (dijit.byId(tt[i]).get("checked")){
			text+="&"+tt[i]+"=1";
		}
	
	}

	return text;
}   
	function printer(p,mode,name){

	    var url = url_report_patient_polydiag+"?project="+project_name+"&panel="+panel+"&edit_mode=0"+"&report_mode=1"+"&this="+dijit.byId("select_this").get("value")+"&impact="+dijit.byId("select_impact").get("value")+"&frequence="+dijit.byId("select_frequence").get("value");
         url+=get_alacarte();
	     url += return_options();
    
        var total_show=0;
     
        
        url += "&transcripts=all";

    //    var username = dojo.cookie("username");

        url += "&user_name="+cookie_username;
      
        if (p == "all"){
       	 var tsamples = storeP._arrayOfAllItems;
       	 var x =0;
  	   	for (i=0,j=tsamples.length; i<j; i++) {
  		  
  		   var t = "check_"+tsamples[i].id[0];
  		 
  		   if( dojo.byId(t).checked == true){
  				window.open(url+"&patients="+tsamples[i].id[0]);
  				x ++;
  		   }
  		   
  		   
  	   }
  	   	if (x ==0){
  	   		alert("Select at least one patient ");
  	   	}
 		
          return;
 	   }
        if (mode == 1) {url += "&print=1&name="+name;}
	 
	   url+="&patients="+p;
	   child = window.open(url); //Open the child in a tiny window.
            window.focus();
	    open_window_report(p,1);
	} 	
		
		function open_window_report(patient,type){
		    	console.dir(tab_patients_polyviewer);
				var url = tab_patients_polyviewer[patient].setUrl+"&print=1";
				
		
		}

var view_polydiag =0;



		  </script>
	</head>
	
    <body class="claro" style ="font-size : 90%;">



<div  data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="design:'sidebar', gutters:true, liveSplitters:true" style="width: 100%;height:100%">
	<div  jsId="header" data-dojo-type="dijit.layout.ContentPane"  data-dojo-props="region:'top'" style="width: 100%;padding:0px;height:65px;overflow-y:hidden" >
		<!--<div  data-dojo-type="dijit.Toolbar"  id="navMenu" style ="font-size: 10px;">
			<div jsId="header" data-dojo-type="dijit.layout.ContentPane"  style="background-color:#F4F4F4;width:100%;min-height:35px;" >
			</div>
			-->
			<!--<div style="width: 50%;margin: 0 auto;">
  				&nbsp;
			</div>            
			<span class="insetheader4"><img src="/icons/Polyicons/bipd4.png" width="50%" height="50%"></span>
			<span class="insetheader5" style="padding-right:8px;">Bioinformatics Paris Descartes,Imagine Institute</span>
		</div> -->
	</div>
	
	<div id="tabPrincipal" jsId="tabPrincipal" data-dojo-type="dijit/layout/TabContainer"  data-dojo-props="region: 'center'" tabPosition="top" tabStrip="true" style="font-size:11px">
 		<div  jsId="summary2" data-dojo-type="dijit/layout/ContentPane" id="tab_project" title="Project"  data-dojo-props="selected:true" href="include_html/diag/project_container.html">
	</div>


	<div id="coverage_stack" data-dojo-type="dijit/layout/ContentPane" title="Coverage"  href="include_html/diag/coverage_container_defidiag.html"  onload="preload_coverage(storeP, 1);setTimeout(function() { load_dropdown_menu_panels_coverage(); }, 2000);"> </div>
    
  
   <div disabled id="editor_stack" jsid="editor_stack" data-dojo-type="dijit/layout/ContentPane" title="PolyViewer" href="include_html/diag/editor_container_polyviewer.html"  onload = "load_tab_polyviewer();update_buttons_polyquery();" style="font-size:9px;width:100%;overflow-x:auto;">
   </div> 
  <!-- 
   <div disabled id="panel_polycyto" jsid="panel_polycyto" data-dojo-type="dijit/layout/ContentPane" title="PolyCyto" onshow="load_tab_polycyto();" style="display:none;font-size:9px;width:100%;overflow-x:auto;">
   		<div id="container_editor_polycyto" jsId="container_editor_polycyto" data-dojo-type="dijit/layout/TabContainer" refreshOnShow="true" data-dojo-props="splitter:false, region:'center'" style="width:100%;height:80%;"></div>
   </div> 
  -->
 		
 				
   </div>
    	
   </div>
   

<div class="edgePanel" data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region: 'bottom'" hidden>
	  <div dojoType="dijit.Toolbar" style="font-size : 09px;width: 100%;">
			<label id="label_genes"style="font-size : 09px;width: 100%;"> - </label>
    </div>
	 <div dojoType="dijit.Toolbar">      
            Patient : <label id="label_patients">
            </label>
      </div>

</div> 
 		<div dojoType="dijit.Dialog" jsId="waiting" id="waiting" style="width:210px;height:120px;" >
           <div class="panel panel-primary" id="pwaiting1" style="height:100%">
                <div class="panel-heading"  id="pwaiting" style="background-color:#1079B2">
                     <h2 class="panel-title" style="font-size: 10px">Loading  
						<div class="spinner pull-right">
                            <div class="bounce1"></div>
                            <div class="bounce2"></div>
                            <div class="bounce3"></div>
						</div>
					</h2>
                </div>
			</div>
		</div>

			</div>
			
		</div>

     <div dojoType="dijit.Dialog" jsId="waiting_progress" id="waiting_progress" style="height:80;" >
        <div data-dojo-type="dijit/ProgressBar" style="width:300px" data-dojo-id="myProgressBar" id="myProgressBar" data-dojo-props="maximum:25"></div>
        <br>
        <span>Loading coverage ...</span>
    </div>
    



   <div id="align" dojoType="dojox.widget.Dialog" sizeToViewport="true"  viewportPadding="130" title="A Dialog Thinger" > 
   	
   <div id="talign"  >
   </div>
</div>

<div id="popup_genes" dojoType="dojox.widget.Dialog"   dimensions="[1000,450]"  onHide="change_label_genes();" > 
	<!-- <div id="content" data-dojo-type="dijit/layout/BorderContainer" style="font-size : 12px;width:1000px;height:445px" data-dojo-props="liveSplitters:false, design:'sidebar'">
        <div  data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'leading', splitter:true, minSize:20" style="width:200px;height:445px">	
 		<div id="bundle_div" > </div>	
		</div>
 		<div data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'center'" style="width:650px;height:445px">
 			<div id="gridDivGenes" style="width:650px;height:445px"> </div>
		</div>
</div> -->
</div>

<div id="popup_coverage" dojoType="dojox.widget.Dialog"   sizeToViewport="true" viewportPadding="20" > 
        <div  id="div_popup_coverage" jsId="div_popup_coverage" data-dojo-type="dijit/layout/ContentPane">	
        	
 		</div>	
		
</div>

<div id="popup_dude" dojoType="dojox.widget.Dialog"   sizeToViewport="true" viewportPadding="20" > 
        <div  id="div_popup_dude" jsId="div_popup_dude" data-dojo-type="dijit/layout/ContentPane">	
        	
 		</div>	
		
</div>
<div id="popup_hgmd" dojoType="dojox.widget.Dialog"   dimensions="[600,300]"   > 
        <div  id="div_popup_hgmd" jsId="div_popup_hgmd" data-dojo-type="dijit/layout/ContentPane">	
        	
 		</div>	
		
</div>
<div id="popup_patient" dojoType="dojox.widget.Dialog"   dimensions="[520,490]" onHide="construct_url('');"> 
 <!-- <div id="gridDivPatients" style="font-size : 9px;width:500px;height:490px">
 </div> -->
</div>

<div id="graph_exon" dojoType="dojox.widget.Dialog"   dimensions="[1020,550]" > 
    <table style="width: 100%; height: 100%;">
        <tr><td> <div id="title_graph" style="font-size: 11pt;height: 40px;"></div></td></tr>
        <tr><td style="width: 810px; height: 450px;" > <div id="chart_exon" style="width: 1010px; height: 450px;"></div></td></tr>
           <tr><td> <div id="status" style="font-size: 11pt;width: 1010px; height: 20px;"></div></td></tr>
    </table> 
</div>

<div id="popup_cldb" dojoType="dojox.widget.Dialog"   sizeToViewport="true" viewportPadding="20" > 
        <div  id="div_popup_cldb" jsId="div_popup_cldb" data-dojo-type="dijit/layout/ContentPane">	
        	
 		</div>	
		
</div>
    <div data-dojo-type="dijit.Menu" id="cellMenu"  style="display: none;">
        <div data-dojo-type="dijit.MenuItem" onClick="click_exon_patient">View Exon/patient coverage</div>
        <div data-dojo-type="dijit.MenuItem" onClick="click_exon">View Exon coverage</div>
        <div data-dojo-type="dijit.MenuItem"onClick="click_patient">View Patient coverage</div>
        <div data-dojo-type="dijit.MenuItem" onClick="click_transcript">View Transcript Coverage</div>
    </div>
    
    <!-- div pour patient name -->
    <div id="popup_patient_name" dojoType="dijit.Dialog" title="Patient Name" style="width:250px" execute="send_print(arguments[0]);">
          <form method="post" class="signin" action="#">
         <fieldset class="textbox">
                <label class="username">
                <span jsId="span_name" id="span_name">Username</span>
                <input id="input_name" name="patient name" value="" type="text" autocomplete="on" placeholder="name">
                </label>
            </fieldset>
            </form>
        <div   type="submit" dojoType="dijit.form.Button"   showLabel="true">
                            <div style='width:150px'>SEND</div>

                  </div>        
    </div>

<div id="login" dojoType="dojox.widget.Dialog" dimensions="[265,160]"   title="Help" onHide="setPassword(arguments[0]);"> 
   <div class="container" style="min-width:250px;max-width:250px;margin-left: auto ;margin-right: auto ;">
   
         <div class="panel panel-success">
          

          <div class="panel-body">     
        <div class="input-group input-group-sm text-success">
            
         <span class="input-group-addon glyphicon glyphicon-user text-success" id="sizing-addon1"></span>
        <label for="username" class="sr-only">Email address</label>
        <input type="text"  id="username" name="username" class="form-control text-primary"  autocomplete="on" placeholder="bipd login" required autofocus aria-describedby="sizing-addon1">
       </div>
          <div class="input-group input-group-sm text-success">
         <span class="input-group-addon glyphicon glyphicon-lock text-success" id="sizing-addon2"></span>
        <label for="passwd" class="sr-only">Password</label>
        <input type="password" id="passwd" name="password" class="form-control  text-primary" placeholder="Password" required aria-describedby="sizing-addon2">
        </div> 
        <button class="btn btn-primary btn-sm btn-x btn-block btn-success" type="submit" onClick="setPassword(arguments[0]);" >Sign in</button>
    </div>
    </div> 
    </div> <!-- /container -->
        </div>


  
     <div id="dialog_help_1" dojoType="dojox.widget.Dialog" sizeToViewport="true"  viewportPadding="130" title="Help" > 
         <div class="panel panel-success">
                <div class="panel-heading">
                     <h2 class="panel-title"> HELP </h2>
                </div>
         <div class="panel-body" id='panel_help'>
          <div class="bs-callout bs-callout-success" style="font-size:15px">
            <h4>Letters stand for <span class='label label-info'>S</span>core <span class='label label-info'>I</span>mpact  <span class='label label-info'>F</span>requence
            </h4>
          </div>
      <div class="bs-callout bs-callout-warning" style="font-size:15px"> 
      <h4> Color highest variation level   for each category  </h4>
                
             <table class="table table-striped table-condensed table-bordered table-hover">
              <tr><th colspan=2>Legend  </th></tr>
                 <tr><td><span class='label label-info'>S</span>core  & <span class='label label-info'>I</span>mpact </td>
    <td style="background-color:#CE0000" class="label">High</td><td style="background-color:#FF8800" class="label">Medium</td><td style="background-color:#95A5A6;color:#FFFFFF" class="label">Low</td></tr><tr><td><span class='label label-info'>F</span>requence </td><td style="background-color:#CE0000" class="label">Unique</td><td style="background-color:#FF8800" class="label">Rare</td><td style="background-color:#EFB73E" class="label">Occasional</td><td style="background-color:#95A5A6;color:#FFFFFF" class="label">Frequent</td></tr>
          </table>
          </div>
          
          </div>
</div>
</div>

    <div dojoType="dijit.Dialog"  jsId="dialog_igv" id="dialog_igv" title="IGV View" style="background-color:white;overflow: auto;" >
    	
            <div class="container-fluid" id="div_igv" style="height:99%;width:99%;"></div>
        </div>  
        <div dojoType="dijit.Dialog" jsId="waiting_variants" id="waiting_variants" style="height:80px" title="VAR PROJECT GENE PATIENT">
	        <img id="wait1" src="images/polyicons/wait18trans.gif" align="absmiddle"> <span>Finding all variations...</span>
	    </div>
	       <div id="dialog_var_from_proj_gene_pat" dojoType="dijit.Dialog" title="Variants from PROJECT / GENE / PATIENT">
			<div class="row" id="content_res_var_from_proj_gene_pat" style="width:99%;"></div>
			<br>
		</div>
	<div dojoType="dijit.Dialog"  jsId="dialog_list_panels" id="dialog_list_panels" title="List Phenotype(s) / Panel(s)" style="background-color:white;overflow:auto;min-width:250px;" >
		 <span id="span_list_panels"></span>
	</div>
	<div id="dialog_hgmd" dojoType="dijit.Dialog" title="Variants from CNV" style="background-color:white;height:98%;width:98%;">
		<br>
        <div class="container-fluid" id="content_res" style="height:99%;width:99%;"></div>
		<br>
	</div>
	<div id="dialog_list_phenotypes" dojoType="dojox.widget.Dialog" dimensions="[1050,850]" title="List Phenotype(s)"> 
		 <table class="table">
			<tbody>
				<tr>
					<td><div id="container_wordcloud" style="height:450px;border: solid black 1px;"></div></td>
				</tr>
			</tbody>
		</table>
		<br>
		<div class="container-fluid" id="content_table_phenotypes" style="height:99%;width:99%;"></div>
	</div>
    
    <div id="dialog_genes_in_panel" dojoType="dijit.Dialog" title="Genes in Panel">
        <div  id="content_genes_in_panel" jsId="content_genes_in_panel" data-dojo-type="dijit/layout/ContentPane"></div>	
	</div>
    
	<div id="dialog_dejavu_polycyto" dojoType="dijit.Dialog" title="DejaVu PolyCyto">
        <div  id="content_dejavu_polycyto" jsId="content_dejavu_polycyto" data-dojo-type="dijit/layout/ContentPane"></div>	
	</div>
    
	<div id="dialog_dejavu_var_infos" dojoType="dijit.Dialog" title="DejaVu Infos">
		<center><a id="url_dejavu_var" href="polydejavu/dejavu.html" target="_blank"><i><u>Go to PolyDejaVu Interface</i></u></a></center>
        <div  id="content_dejavu_var_infos" jsId="content_dejavu_var_infos" data-dojo-type="dijit/layout/ContentPane"></div>	
	</div>
	
    <div id="dialog_igv_alamut_download_infos" dojoType="dijit.Dialog" title="IGV / Alamut Downloads">
        <u><b>IGV APP:</b></u> <a href="https://software.broadinstitute.org/software/igv/" target="_blank">Website</a> <a href="https://software.broadinstitute.org/software/igv/download" target="_blank">Download</a> <a href="https://software.broadinstitute.org/software/igv/Desktop" target="_blank">Documentation</a><br><br>
        <u><b>Alamut APP:</b></u> <a href="https://www.interactive-biosoftware.com/alamut-visual/" target="_blank">Website</a><br>
	</div>
	<div id="popup_patients" dojoType="dojox.widget.Dialog"   dimensions = "[750, 650]" sizeToViewport="false" style="width:800px;height:600px;font-size: 10px;font-family:Verdana;width:800px" viewportPadding="10" onHide="var_load_polyviewer=1;refresh_tab_polyviewer();refresh_tab_polydiag();refresh_tab_polydude();"> 
	  <div id="gridDivPatients" style="font-size: 10px;font-family:Verdana;width:700px;height:600px">
 </div> 
    </body>
</html>
